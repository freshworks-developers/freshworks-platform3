---
description: Complete Platform 3.0 App Templates - Working code examples for all app types
alwaysApply: true
---

# Platform 3.0 App Templates

**UNIVERSAL CRITICAL ENFORCEMENT - NO EXCEPTIONS - NO CONTRADICTIONS:**

### ❌ NEVER Generate These (Immediate Rejection)
- ❌ `"whitelisted-domains"` - Platform 2.3 syntax
- ❌ `"product"` structure - Use `"modules"`
- ❌ Plain HTML: `<button>`, `<input>`, `<select>`, `<textarea>`
- ❌ `{{variable}}` syntax - Causes FQDN errors
- ❌ Host with path: `api.example.com/api` - MUST be FQDN only
- ❌ Host with encoded chars: `%7B%7Bvar%7D%7D.example.com`
- ❌ Path without `/`: `api/endpoint` - MUST start with `/`
- ❌ App files in workspace root
- ❌ Frontend app without `icon.svg` - #1 validation failure
- ❌ OAuth credentials in `iparams.json`

### ✅ ALWAYS Generate These (Mandatory)
- ✅ **`app/styles/images/icon.svg`** - MUST EXIST - NO EXCEPTIONS
- ✅ **FQDN only hosts** - `api.example.com` (no path)
- ✅ **Paths start with `/`** - `/api/v2/endpoint`
- ✅ **`<%= context.variable %>`** - For iparams
- ✅ **`<%= iparam.name %>`** - For app-specific iparams
- ✅ **`<%= access_token %>`** - For OAuth
- ✅ **`"modules"` structure** - NOT `"product"`
- ✅ **`"engines"` block** - node and fdk versions
- ✅ **Crayons components** - fw-button, fw-input, etc.
- ✅ **Crayons CDN in ALL HTML** - BOTH script tags
- ✅ **New app folder** - e.g., `my-app/`
- ✅ **`oauth_iparams` in `oauth_config.json`**
- ✅ **At least one product module**

---

## Understanding Product Context

When user says "Freshdesk app" or "Freshservice app":
- ❌ DOES NOT mean product-specific manifest structure
- ✅ DOES mean use the appropriate module for that product

**Module Mapping:**
- "Freshdesk app" → Use `support_ticket`, `support_contact`, etc. modules
- "Freshservice app" → Use `service_ticket`, `service_asset`, etc. modules
- "Freshsales app" → Use `deal`, `contact`, `account` modules

**Base template is ALWAYS the same - only the module name changes!**

---

## Template Selection Matrix

| User Need | Template | Modules to Use |
|-----------|----------|----------------|
| Frontend UI only | Template 1 (Frontend) | common + product module with location |
| Serverless events | Template 2 (Serverless) | common + product module with events |
| Frontend + Backend API | Template 3 (Hybrid) | common (requests + functions) + product module (location) |
| OAuth integration (ONLY if required) | Template 4 (OAuth) | common (requests + functions + oauth) + product module |

**CRITICAL: When to Use OAuth vs API Key**

**Use OAuth ONLY when:**
- ✅ Third-party service REQUIRES OAuth (GitHub, Jira, Salesforce, Google APIs, Slack, etc.)
- ✅ User needs to authorize access to their account on the external service
- ✅ App needs to act on behalf of the user
- ✅ External service doesn't offer API key authentication

**DO NOT use OAuth when:**
- ❌ External service accepts API keys, tokens, or webhook URLs (Zapier, most REST APIs)
- ❌ User can provide a simple API key or webhook URL
- ❌ No user authorization flow is needed

**Example:** "Zapier webhook sync" → ❌ NO OAuth (use webhook URL in iparams) | "GitHub issue sync" → ✅ OAuth required

**Default: Use API key in iparams. Only use OAuth if service explicitly requires it.**

---

## When to Include Frontend (CRITICAL DECISION POINT)

**ALWAYS include frontend (Template 1 or 3) when:**
- ✅ User needs to **view, configure, or interact** with the app
- ✅ User needs to **see status, logs, or sync results**
- ✅ User needs to **manually trigger actions** (buttons, forms)
- ✅ User needs to **configure settings beyond iparams** (dynamic options, toggles)
- ✅ App provides **dashboard, reports, or visualizations**
- ✅ User mentions "UI", "interface", "page", "view", "dashboard", "panel", "sidebar"
- ✅ App needs a **placement** (ticket_sidebar, full_page_app, etc.)
- ✅ User mentions sync app, you must create hybrid unless mentioned serverless

**Use serverless only (Template 2) when:**
- ❌ Pure automation with **zero user interaction**
- ❌ Background sync that **never needs monitoring**
- ❌ Webhook receiver with **no status display**
- ❌ Scheduled tasks with **no manual controls**
- ❌ User explicitly says "no UI needed" or "background only"

**Examples:**

| Use Case | Frontend? | Why? |
|----------|-----------|------|
| "Zapier contact sync with webhook" | ✅ YES (Hybrid) | User needs to see sync status, manually trigger sync, configure which events to sync, Enforce a hybrid model | Enforce a hybrid model
| "Auto-sync contacts to Zapier on create" | ✅ YES (Hybrid) | User needs to monitor sync status, see errors, manually resync failed contacts, Enforce a hybrid model |
| "Send webhook on ticket close" | ❌ NO (Serverless) | Pure automation, no user interaction needed |
| "Scheduled backup every night" | ❌ NO (Serverless) | Background task, no monitoring needed |
| "GitHub issue sync" | ✅ YES (Hybrid) | User needs to see linked issues, manually create links, view sync status |
| "Slack notification on ticket create" | ❌ NO (Serverless) | Pure notification, no user interaction |

**Default Rule: When in doubt, include frontend (Hybrid).** Users almost always want to see what's happening.

**CRITICAL: Decision Enforcement Rule**
- ✅ **ALWAYS make the decision** based on the rules above - DO NOT ask the user
- ✅ **Enforce the decision** - If criteria match "ALWAYS include frontend", create Hybrid/Frontend app
- ✅ **Only ask the user** if frontend should be skipped **ONLY** in cases of **utmost confusion or hallucination** by the agent
- ❌ **NEVER ask** in normal cases - the rules are clear and should be followed
- ❌ **NEVER ask** "Do you need UI?" - Make the decision based on the criteria

---

## Code Quality Patterns (ALWAYS ENFORCE)

**These patterns prevent common FDK validation failures:**

### ✅ Pattern 1: Proper Async Scoping
```javascript
// ❌ WRONG: Variable in different scope
let client;
async function init() {
  client = await app.initialized();  // Race condition!
}

// ✅ CORRECT: IIFE pattern
(async function() {
  const client = await app.initialized();
  // Use client here
})();
```

### ✅ Pattern 2: Low Complexity Functions
```javascript
// ❌ WRONG: Nested complexity > 7
async function process() {
  if (a) {
    if (b) {
      for (let i = 0; i < items.length; i++) {
        if (items[i].valid) {
          // Deep nesting
        }
      }
    }
  }
}

// ✅ CORRECT: Extract helpers
async function process() {
  const validItems = getValidItems();
  return processItems(validItems);
}
```

### ✅ Pattern 3: No Unused Parameters
```javascript
// ❌ WRONG: Unused 'args'
exports = {
  handler: function(args) {
    console.log('Called');  // args never used!
  }
}

// ✅ CORRECT: Remove or use underscore
exports = {
  handler: function() {
    console.log('Called');
  }
}
```

### ✅ Pattern 4: Helper Functions in Server.js
```javascript
// ❌ WRONG: Helper function BEFORE exports (FDK parser error!)
function parseUrl(url) {
  return new URL(url);
}

exports = {
  myHandler: function(args) {
    const parsed = parseUrl(args.url);
  }
};

// ✅ CORRECT Option 1: Helper function INSIDE exports
exports = {
  parseUrl: function(url) {
    return new URL(url);
  },
  
  myHandler: function(args) {
    const parsed = this.parseUrl(args.url);
  }
};

// ✅ CORRECT Option 2: Helper function AFTER exports
exports = {
  myHandler: function(args) {
    const parsed = parseUrl(args.url);
  }
};

function parseUrl(url) {
  return new URL(url);
}

// ✅ CORRECT Option 3: Inline helper (for simple logic)
exports = {
  myHandler: function(args) {
    const parseUrl = (url) => new URL(url);
    const parsed = parseUrl(args.url);
  }
};
```

**CRITICAL:** FDK's parser fails if functions are defined BEFORE the exports block!

### ✅ Pattern 5: Async Functions Must Use Await - ZERO TOLERANCE

**CRITICAL ENFORCEMENT:** Every `async` function MUST contain at least one `await` expression, OR remove `async` keyword.

**Lint Error:** "Async function has no 'await' expression"

```javascript
// ❌ WRONG: Async without await (LINT ERROR - NEVER DO THIS)
exports = {
  syncAllContacts: async function(args) {
    return $request.invokeTemplate('apiCall', {});  // Missing await!
  }
};

// ✅ CORRECT Option 1: Add await
exports = {
  syncAllContacts: async function(args) {
    return await $request.invokeTemplate('apiCall', {});
  }
};

// ✅ CORRECT Option 2: Remove async if no await needed
exports = {
  syncAllContacts: function(args) {
    return $request.invokeTemplate('apiCall', {});
  }
};
```

**ENFORCEMENT:**
- ✅ Every `async` MUST have `await`
- ✅ If no `await`, REMOVE `async`
- ❌ NEVER use `async` without `await`
- **NON-NEGOTIABLE - ALWAYS ENFORCE**

### ✅ Pattern 6: Scheduled Events Cannot Be Declared in Manifest
```json
// ❌ WRONG: Scheduled events in manifest (Platform error!)
{
  "modules": {
    "common": {
      "events": {
        "onScheduledSync": {  // ❌ INVALID!
          "handler": "syncHandler"
        }
      }
    }
  }
}
```

```javascript
// ✅ CORRECT: Scheduled events are created dynamically, NOT in manifest
exports = {
  onAppInstallHandler: async function(args) {
    // Create scheduled event dynamically
    await $schedule.create({
      name: "dailySync",
      schedule_at: new Date(Date.now() + 86400000).toISOString(),
      time_unit: "days",
      frequency: 1,
      data: { syncType: "full" }
    });
  },
  
  // Handler for scheduled event (called when schedule fires)
  scheduledSyncHandler: async function(payload) {
    // This handler is called by the platform when schedule fires
    // It's NOT declared in manifest - platform calls it automatically
    await syncContacts(payload.data);
  }
};
```

**CRITICAL:** Scheduled events are created at runtime using `$schedule.create()`. They CANNOT be declared in `manifest.json` events section. Only product events (onTicketCreate, etc.) and app setup events (onAppInstall, onAppUninstall) can be declared in manifest.

### ✅ Pattern 7: Avoid Unreachable Code
```javascript
// ❌ WRONG: Code after return statement
exports = {
  myHandler: function(args) {
    if (!args.data) {
      return { error: 'No data' };
    }
    
    // ❌ UNREACHABLE: This code never executes if args.data is falsy
    const result = processData(args.data);
    return result;
  }
};

// ✅ CORRECT: Proper control flow
exports = {
  myHandler: function(args) {
    if (!args.data) {
      return { error: 'No data' };
    }
    
    // ✅ REACHABLE: Only executes if args.data exists
    const result = processData(args.data);
    return result;
  }
};
```

**CRITICAL:** Ensure all code paths are reachable. Remove code after return statements or restructure logic.

### ✅ Pattern 8: Always Generate Icon
```
MUST CREATE: app/styles/images/icon.svg
NEVER SKIP THIS FILE - FDK validation will fail!
```

---

## Template 1: Frontend App

**Use Case:** UI-only app with no backend logic

### App Structure
```
my-app/
├── app/
│   ├── index.html
│   ├── scripts/
│   │   └── app.js
│   └── styles/
│       ├── style.css
│       └── images/
│           └── icon.svg  ← ALWAYS CREATE THIS!
├── manifest.json
└── README.md
```

### manifest.json (CORRECT PLATFORM 3.0)
```json
{
  "platform-version": "3.0",
  "modules": {
    "common": {
      "requests": {}
    },
    "support_ticket": {
      "location": {
        "ticket_sidebar": {
          "url": "index.html",
          "icon": "styles/images/icon.svg"
        }
      }
    }
  },
  "engines": {
    "node": "18.20.8",
    "fdk": "9.7.4"
  }
}
```

### app/scripts/app.js
```javascript
// ✅ CORRECT: Proper async scoping (no race conditions)
(async function() {
  const client = await app.initialized();
  
  client.events.on('app.activated', async () => {
    await renderText(client);
  });
  
  // ✅ Keep function complexity low (≤ 7)
  async function renderText(client) {
    const textElement = document.getElementById('apptext');
    const contactData = await client.data.get('contact');
    const { contact: { name } } = contactData;
    
    textElement.innerHTML = `Ticket is created by ${name}`;
  }
})();
```

### app/index.html
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <title>My App</title>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script async src="{{{appclient}}}"></script>
  <link rel="stylesheet" type="text/css" href="styles/style.css" />
</head>
<body>
  <div class="main">
    <p id="apptext"></p>
  </div>
</body>
<script defer src="scripts/app.js"></script>
<!-- REQUIRED: Crayons CDN for UI components -->
<script async type="module" src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.esm.js"></script>
<script async nomodule src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.js"></script>
</html>
```

### app/styles/style.css
```css
.main {
  padding: 20px;
  font-family: Arial, sans-serif;
}
```

### app/styles/images/icon.svg
```xml
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64">
  <rect width="64" height="64" fill="#2C5CC5"/>
  <text x="32" y="40" font-size="32" fill="white" text-anchor="middle" font-family="Arial">A</text>
</svg>
```

**Freshservice variant:** Change `"support_ticket"` to `"service_ticket"`
**Freshsales variant:** Change `"support_ticket"` to `"deal"` or `"contact"`

---

## Template 2: Serverless App

**Use Case:** Backend-only app with events, no UI

### App Structure
```
my-serverless-app/
├── server/
│   └── server.js           # Can also be in root as server.js
├── config/
│   └── iparams.json
├── manifest.json
└── README.md
```

**Note:** `server.js` can be located in either:
- `server/server.js` (recommended for organization)
- `server.js` (root directory, also valid)

**CRITICAL:** If app uses `config/iparams.json` with any parameters (not empty `{}`), MUST include `onAppInstall` event handler in `modules.common.events` to access iparams during installation.

**CRITICAL:** If app has scheduled events (`$schedule.create()`), background tasks, webhooks, or recurring processes, MUST include `onAppUninstall` event handler in `modules.common.events` to clean up when app is uninstalled.

### manifest.json (CORRECT PLATFORM 3.0)
```json
{
  "platform-version": "3.0",
  "modules": {
    "common": {
      "events": {
        "onAppInstall": {
          "handler": "onAppInstallHandler"
        },
        "onAppUninstall": {
          "handler": "onAppUninstallHandler"
        }
      }
    },
    "support_ticket": {
      "events": {
        "onTicketCreate": {
          "handler": "onTicketCreateHandler"
        }
      }
    }
  },
  "engines": {
    "node": "18.20.8",
    "fdk": "9.7.4"
  }
}
```

### server/server.js
```javascript
// ✅ CORRECT: Only include parameters you actually use
// ✅ Keep function complexity low (≤ 7)
exports = {
  // Uses args - keep parameter
  onTicketCreateHandler: function(args) {
    const requesterName = args.data.requester.name;
    console.log('Hello ' + requesterName);
  },
  
  // Uses args - keep parameter
  onAppInstallHandler: function(args) {
    console.info('onAppInstallHandler invoked', args);
  },
  
  // Doesn't use args - remove parameter
  onAppUninstallHandler: function() {
    console.log('onAppUninstallHandler invoked');
  }
};

// ✅ If handler signature REQUIRES parameter but you don't use it:
// Use underscore prefix to indicate intentionally unused
exports = {
  myHandler: function(_args) {
    // _args indicates intentionally unused
    console.log('Handler called');
  }
};
```

**Freshservice variant:** Change `"support_ticket"` to `"service_ticket"` and use `onTicketCreate` event

**Adding External API calls:**
```json
{
  "modules": {
    "common": {
      "requests": {
        "notifyExternalService": {}
      }
    }
  }
}
```

---

## Template 3: Hybrid App (Frontend + Backend SMI)

**Use Case:** Frontend UI that calls backend methods for external API calls

### App Structure
```
my-hybrid-app/
├── app/
│   ├── index.html
│   ├── scripts/
│   │   └── app.js
│   └── styles/
│       ├── style.css
│       └── images/
│           └── icon.svg
├── server/
│   └── server.js
├── config/
│   ├── iparams.json
│   └── requests.json
├── manifest.json
└── README.md
```

### manifest.json (CORRECT PLATFORM 3.0)
```json
{
  "platform-version": "3.0",
  "modules": {
    "common": {
      "requests": {
        "externalApiCall": {}
      },
      "functions": {
        "fetchExternalData": {}
      }
    },
    "support_ticket": {
      "location": {
        "ticket_sidebar": {
          "url": "index.html",
          "icon": "styles/images/icon.svg"
        }
      }
    }
  },
  "engines": {
    "node": "18.20.8",
    "fdk": "9.7.4"
  }
}
```

### config/requests.json
```json
{
  "externalApiCall": {
    "schema": {
      "method": "GET",
      "host": "api.example.com",
      "path": "/data",
      "headers": {
        "Authorization": "Bearer {{api_key}}"
      }
    }
  }
}
```

### config/iparams.json
```json
{
  "api_key": {
    "display_name": "API Key",
    "description": "Enter your API key",
    "type": "text",
    "required": true,
    "secure": true
  }
}
```

### app/index.html
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Hybrid App</title>
  <meta charset="UTF-8" />
  <script async src="{{{appclient}}}"></script>
  <link rel="stylesheet" href="styles/style.css" />
</head>
<body>
  <div class="main">
    <fw-label value="Fetch Data from External API"></fw-label>
    <fw-button id="btnFetch" color="primary">Fetch Data</fw-button>
    <div id="result"></div>
  </div>
</body>
<script defer src="scripts/app.js"></script>
<!-- REQUIRED: Crayons CDN -->
<script async type="module" src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.esm.js"></script>
<script async nomodule src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.js"></script>
</html>
```

### app/scripts/app.js
```javascript
let client;

init();

async function init() {
  client = await app.initialized();
  client.events.on('app.activated', onAppActivate);
}

function onAppActivate() {
  // Use Crayons button event listener
  const btn = document.getElementById('btnFetch');
  btn.addEventListener('fwClick', fetchData);
}

async function fetchData() {
  try {
    const result = await client.request.invoke('fetchExternalData', {
      param1: 'value1'
    });
    document.getElementById('result').innerHTML = JSON.stringify(result);
  } catch (error) {
    console.error('Error:', error);
  }
}
```

### server/server.js
```javascript
exports = {
  fetchExternalData: async function(args) {
    const { param1 } = args;
    const iparams = args.iparams;

    try {
      const response = await $request.invokeTemplate('externalApiCall', {
        context: {},
        body: JSON.stringify({ query: param1 })
      });

      return { success: true, data: response.response };
    } catch (error) {
      console.error('API Error:', error);
      return { success: false, error: error.message };
    }
  }
};
```

**Freshservice variant:** Change `"support_ticket"` to `"service_ticket"`

---

## Template 4: OAuth App

**Use Case:** Third-party OAuth integration (GitHub, Jira, etc.)

**CRITICAL: Platform 3.0 OAuth requires `integrations` wrapper!**

### App Structure
```
my-oauth-app/
├── app/
│   ├── index.html
│   ├── scripts/
│   │   └── app.js
│   └── styles/
│       ├── style.css
│       └── images/
│           └── icon.svg
├── server/
│   └── server.js
├── config/
│   ├── iparams.json
│   ├── requests.json
│   └── oauth_config.json
├── manifest.json
└── README.md
```

### manifest.json (CORRECT PLATFORM 3.0)
```json
{
  "platform-version": "3.0",
  "modules": {
    "common": {
      "requests": {
        "getOAuthResource": {}
      },
      "functions": {
        "fetchOAuthData": {}
      }
    },
    "support_ticket": {
      "location": {
        "ticket_sidebar": {
          "url": "index.html",
          "icon": "styles/images/icon.svg"
        }
      }
    }
  },
  "engines": {
    "node": "18.20.8",
    "fdk": "9.7.4"
  }
}
```

### config/oauth_config.json
```json
{
  "integrations": {
    "github": {
      "display_name": "GitHub",
      "client_id": "<%= oauth_iparams.client_id %>",
      "client_secret": "<%= oauth_iparams.client_secret %>",
      "authorize_url": "https://github.com/login/oauth/authorize",
      "token_url": "https://github.com/login/oauth/access_token",
      "token_type": "account",
      "options": {
        "scope": "repo"
      },
      "oauth_iparams": {
        "client_id": {
          "display_name": "GitHub Client ID",
          "description": "Enter your GitHub OAuth App Client ID",
          "type": "text",
          "required": true
        },
        "client_secret": {
          "display_name": "GitHub Client Secret",
          "description": "Enter your GitHub OAuth App Client Secret",
          "type": "text",
          "required": true,
          "secure": true
        }
      }
    }
  }
}
```

**CRITICAL:** Use `<%= oauth_iparams.client_id %>` and define `oauth_iparams` INSIDE the integration object

### config/iparams.json (App-specific settings ONLY)
```json
{
  "google_sheet_id": {
    "display_name": "Target Google Sheet ID",
    "description": "The ID found in your spreadsheet URL",
    "type": "text",
    "required": true,
    "secure": false
  }
}
```

### config/requests.json (Using both OAuth and iparams)
```json
{
  "googleSheetsAppend": {
    "schema": {
      "protocol": "https",
      "method": "POST",
      "host": "sheets.googleapis.com",
      "path": "/v4/spreadsheets/<%= iparam.google_sheet_id %>/values/<%= context.range %>:append",
      "headers": {
        "Authorization": "Bearer <%= access_token %>",
        "Content-Type": "application/json"
      },
      "query": {
        "valueInputOption": "USER_ENTERED",
        "insertDataOption": "INSERT_ROWS"
      }
    },
    "options": {
      "oauth": "google_sheets"
    }
  },
  "googleSheetsGet": {
    "schema": {
      "protocol": "https",
      "method": "GET",
      "host": "sheets.googleapis.com",
      "path": "/v4/spreadsheets/<%= iparam.google_sheet_id %>/values/Sheet1!A:E",
      "headers": {
        "Authorization": "Bearer <%= access_token %>"
      }
    },
    "options": {
      "oauth": "google_sheets"
    }
  }
}
```

**ZERO TOLERANCE: This is the ONLY correct structure - no alternatives**

### server/server.js
```javascript
exports = {
  fetchOAuthData: async function(args) {
    try {
      const response = await $request.invokeTemplate('getOAuthResource', {
        context: {}
      });

      return { success: true, data: response.response };
    } catch (error) {
      console.error('OAuth API Error:', error);
      return { success: false, error: error.message };
    }
  }
};
```

**Freshservice variant:** Change `"support_ticket"` to `"service_ticket"`

---

## STRICT ENFORCEMENT RULES

### ❌ NEVER Generate These (Platform 2.3 Patterns):

```json
// WRONG - DO NOT GENERATE
{
  "whitelisted-domains": ["https://..."]  // ❌ DEPRECATED
}
```

```json
// WRONG - DO NOT GENERATE
{
  "product": {  // ❌ USE "modules" INSTEAD
    "freshdesk": {}
  }
}
```

```json
// WRONG - DO NOT GENERATE
{
  "platform-version": "2.3"  // ❌ USE "3.0"
}
```

### ✅ ALWAYS Generate These (Platform 3.0 Patterns):

```json
// CORRECT
{
  "platform-version": "3.0",
  "modules": {
    "common": {},
    "support_ticket": {}  // or service_ticket, deal, etc.
  },
  "engines": {
    "node": "18.20.8",
    "fdk": "9.7.4"
  }
}
```

---

## External API Call Pattern (NO WHITELISTED-DOMAINS!)

When user needs to call an external API:

### Step 1: Add request template to manifest
```json
{
  "modules": {
    "common": {
      "requests": {
        "myApiCall": {}
      }
    }
  }
}
```

### Step 2: Define request in config/requests.json
```json
{
  "myApiCall": {
    "schema": {
      "method": "GET",
      "host": "api.example.com",
      "path": "/endpoint",
      "headers": {
        "Authorization": "Bearer {{api_key}}"
      }
    }
  }
}
```

### Step 3: Call from backend
```javascript
const response = await $request.invokeTemplate('myApiCall', {
  context: {},
  body: JSON.stringify({ data: 'value' })
});
```

**NO `whitelisted-domains` NEEDED - Request templates handle external domains!**

---

## Module Adaptation Guide

When adapting templates for different products:

| User Says | Change Module To | Keep Everything Else Same |
|-----------|------------------|---------------------------|
| "Freshdesk ticket sidebar" | `support_ticket` | ✅ Use same base template |
| "Freshservice ticket sidebar" | `service_ticket` | ✅ Use same base template |
| "Freshservice asset sidebar" | `service_asset` | ✅ Use same base template |
| "Freshsales deal page" | `deal` | ✅ Use same base template |

**CRITICAL: Location Placement Rules**

**Common Module Locations (ONLY these):**
- `modules.common.location.full_page_app` ✅
- `modules.common.location.cti_global_sidebar` ✅ (Freshdesk only)

**Product Module Locations (NEVER in common):**
- Freshdesk ticket: `modules.support_ticket.location.ticket_sidebar` ✅
- Freshservice ticket: `modules.service_ticket.location.ticket_sidebar` ✅
- Freshservice asset: `modules.service_asset.location.asset_sidebar` ✅
- Freshsales deal: `modules.deal.location.deal_entity_menu` ✅

**❌ WRONG - Will cause validation error:**
```json
{
  "modules": {
    "common": {
      "location": {
        "ticket_sidebar": { ... }  // ❌ INVALID!
      }
    }
  }
}
```

**✅ CORRECT:**
```json
{
  "modules": {
    "common": {},
    "support_ticket": {
      "location": {
        "ticket_sidebar": { ... }  // ✅ CORRECT!
      }
    }
  }
}
```

---

## Required File Structure

**CRITICAL: Always generate complete folder structure!**

### Frontend App Minimum Files:
```
app/
├── index.html
├── scripts/
│   └── app.js
└── styles/
    ├── style.css
    └── images/
        └── icon.svg
```

### Serverless App Minimum Files:
```
server/
└── server.js
config/
└── iparams.json (if needed)
```

### Default icon.svg:
Use the Freshworks default icon from skeleton. If generating, create a simple SVG:
```xml
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64">
  <rect width="64" height="64" fill="#2C5CC5"/>
  <text x="32" y="40" font-size="32" fill="white" text-anchor="middle" font-family="Arial">A</text>
</svg>
```

### style.css:
Always include basic styling:
```css
.main {
  padding: 20px;
}
```

## Template Selection Logic

```
IF user needs UI → Start with Template 1 (Frontend)
  IF also needs backend calls → Use Template 3 (Hybrid)
  IF needs OAuth → Use Template 4 (OAuth)

IF user needs NO UI → Start with Template 2 (Serverless)
  IF needs external API → Add requests to common module

ALWAYS:
  1. Start with correct skeleton
  2. Create complete folder structure
  3. Generate all required files (HTML, JS, CSS, icon.svg)
  4. Change module name based on product
  5. Add requests/functions as needed
  6. NEVER add whitelisted-domains
  7. NEVER use "product" structure
```

---

## Validation Checklist

Before generating any manifest.json, verify:

### Platform 3.0 Structure
- [ ] `"platform-version": "3.0"` ✅
- [ ] `"modules"` structure (NOT "product") ✅
- [ ] At least one product module (even if empty `{}`) ✅
- [ ] `"engines"` block present ✅
- [ ] All requests declared in `"requests": {}` ✅
- [ ] All SMI functions declared in `"functions": {}` ✅
- [ ] NO `"whitelisted-domains"` ✅
- [ ] Correct module name for product ✅
- [ ] **Locations in correct module** ✅
  - `full_page_app` and `cti_global_sidebar` → `modules.common.location`
  - `ticket_sidebar`, `asset_sidebar`, etc. → `modules.<product>.location`
- [ ] **OAuth config has `integrations` wrapper** ✅
- [ ] **OAuth request template has `options.oauth` and `access_token` header** ✅
- [ ] **If iparams are used** → `onAppInstall` event handler declared in `modules.common.events` ✅
- [ ] **If app has scheduled events/background tasks** → `onAppUninstall` event handler declared in `modules.common.events` ✅

### File Structure (CRITICAL - Common Failures!)
- [ ] **Complete folder structure generated** ✅
  - Frontend apps: `app/scripts/`, `app/styles/images/`
- [ ] **icon.svg ALWAYS created** ✅ - `app/styles/images/icon.svg`
- [ ] **style.css created** ✅ - `app/styles/style.css`
- [ ] **All HTML, JS files created** ✅

### Code Quality (Based on Real Failures!)
- [ ] **Function complexity ≤ 7** ✅
  - Break complex functions into helpers
  - Extract nested logic
- [ ] **No async variable scoping issues** ✅
  - Use IIFE pattern: `(async function() { ... })()`
  - Declare variables in same scope
  - Warning: "'client' declared and assigned in different scopes"
- [ ] **No unused parameters** ✅
  - Remove unused parameters
  - Or use underscore prefix: `_args`
- [ ] **Only use `async` when you `await`** ✅
  - Remove `async` keyword if no `await` inside
  - Lint error: "Async function has no 'await' expression"
- [ ] **No unreachable code** ✅
  - Remove code after return statements
  - Restructure control flow if needed
  - Lint error: "Unreachable code"
- [ ] **Scheduled events NOT in manifest** ✅
  - ❌ NEVER declare `onScheduled*` events in manifest
  - ✅ Create scheduled events dynamically with `$schedule.create()`
  - Platform error: "Invalid event: 'onScheduledSync' for module: common"
- [ ] **Helper functions AFTER exports** ✅
  - ❌ NEVER define functions BEFORE exports block
  - ✅ Define helpers INSIDE exports, AFTER exports, or inline
  - FDK parser error: "Error while parsing file containing serverless functions"
- [ ] **NEVER use deprecated Request API methods** ✅
  - ❌ NO `$request.post()`, `.get()`, `.put()`, `.delete()`
  - ✅ ALWAYS use `$request.invokeTemplate()`
  - Platform error: "post is no longer supported in Request API"
- [ ] **Proper error handling** ✅
  - Use try/catch blocks
  - Handle API failures gracefully

### Crayons UI (Frontend Only - STRICT ENFORCEMENT!)
- [ ] **Crayons CDN included in ALL HTML files** ✅
  - Must include BOTH script tags (ESM and nomodule)
  - Required even if no UI components yet
- [ ] **NO plain HTML form elements** ✅
  - ❌ NO `<button>` - Use `<fw-button>`
  - ❌ NO `<input>` - Use `<fw-input>`
  - ❌ NO `<select>` - Use `<fw-select>` with `<fw-select-option>`
  - ❌ NO `<textarea>` - Use `<fw-textarea>`
  - ❌ NO `<label>` - Use `<fw-label>` or `label` attribute on components
- [ ] **Use Crayons components ONLY** ✅
  - All interactive elements must be Crayons components
  - All form inputs must be Crayons components
  - All buttons must be Crayons components
- [ ] **Crayons event listeners** ✅
  - Use `fwClick` for buttons (not `click`)
  - Use `fwInput` for inputs (not `input`)
  - Use `fwChange` for selects (not `change`)

If ANY of these fail → REJECT and fix before generating!

---

## Critical Location Rules

**❌ VALIDATION ERROR: "Invalid location(s) mentioned in modules"**

This error means a location is in the wrong module!

**Common Module** (`modules.common.location`) - ONLY these:
- `full_page_app` ✅
- `cti_global_sidebar` ✅ (Freshdesk/Freshservice only)

**Product Module** (`modules.support_ticket.location`) - Product-specific:
- `ticket_sidebar` ✅
- `ticket_requester_info` ✅
- `ticket_background` ✅
- `ticket_top_navigation` ✅
- `asset_sidebar` ✅ (in `service_asset`)
- `deal_entity_menu` ✅ (in `deal`)

**Example of WRONG vs CORRECT:**

❌ **WRONG - Causes validation error:**
```json
{
  "modules": {
    "common": {
      "location": {
        "ticket_sidebar": { ... }  // ❌ INVALID!
      }
    },
    "support_ticket": {}
  }
}
```

✅ **CORRECT:**
```json
{
  "modules": {
    "common": {},
    "support_ticket": {
      "location": {
        "ticket_sidebar": { ... }  // ✅ CORRECT!
      }
    }
  }
}
```

---

## Critical OAuth Rules

**❌ VALIDATION ERROR: "OAuth config must have required property 'integrations'"**

This means `oauth_config.json` is missing the `integrations` wrapper!

**Platform 3.0 OAuth Structure:**

❌ **WRONG - Platform 2.x format:**
```json
{
  "client_id": "...",
  "client_secret": "...",
  "authorize_url": "...",
  "token_url": "..."
}
```

✅ **CORRECT - Platform 3.0 format:**
```json
{
  "integrations": {
    "oauth_name": {
      "display_name": "Service Name",
      "client_id": "{{client_id}}",
      "client_secret": "{{client_secret}}",
      "authorize_url": "https://...",
      "token_url": "https://...",
      "token_type": "account",
      "options": {
        "scope": "read"
      }
    }
  }
}
```

**OAuth Request Template:**

Must include:
1. `options.oauth` with OAuth config name
2. `Authorization` header with `<%= access_token %>`

```json
{
  "myOAuthRequest": {
    "schema": {
      "method": "GET",
      "host": "api.example.com",
      "path": "/resource",
      "headers": {
        "Authorization": "bearer <%= access_token %>"
      }
    },
    "options": {
      "oauth": "oauth_name"
    }
  }
}
```

---

## Critical Request API Rules

**❌ VALIDATION ERROR: "post is no longer supported in Request API"**

This means you're using deprecated Platform 2.x request methods!

**Platform 2.x Deprecated Methods (NEVER USE):**

❌ **WRONG - Platform 2.x format:**
```javascript
// These methods are DEPRECATED and will cause errors!
$request.post('https://api.example.com/endpoint', options)
$request.get('https://api.example.com/data', options)
$request.put('https://api.example.com/update', options)
$request.delete('https://api.example.com/remove', options)
```

✅ **CORRECT - Platform 3.0 format:**

**Step 1: Define request template in `config/requests.json`:**
```json
{
  "myApiCall": {
    "schema": {
      "method": "POST",
      "host": "api.example.com",
      "path": "/endpoint",
      "headers": {
        "Authorization": "Bearer {{api_key}}",
        "Content-Type": "application/json"
      }
    }
  }
}
```

**Step 2: Use in `server/server.js`:**
```javascript
exports = {
  myHandler: async function(args) {
    try {
      const response = await $request.invokeTemplate('myApiCall', {
        context: {},
        body: JSON.stringify({ data: 'value' })
      });
      
      return { success: true, data: response.response };
    } catch (error) {
      console.error('API Error:', error);
      return { success: false, error: error.message };
    }
  }
};
```

**Key Points:**
- ❌ NEVER use `$request.post()`, `.get()`, `.put()`, `.delete()`
- ✅ ALWAYS use `$request.invokeTemplate('templateName', options)`
- Define all external API calls in `config/requests.json`
- Reference templates by name in server code

---

## Crayons UI Enforcement

**ALL frontend apps MUST use Crayons components - NO exceptions!**

### Required in ALL HTML Files:
```html
<!-- REQUIRED: Crayons CDN -->
<script async type="module" src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.esm.js"></script>
<script async nomodule src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.js"></script>
```

### ❌ NEVER Use Plain HTML Elements:
```html
<!-- WRONG - DO NOT USE -->
<button>Click Me</button>
<input type="text" />
<select><option>Item</option></select>
<textarea></textarea>
```

### ✅ ALWAYS Use Crayons Components:
```html
<!-- CORRECT - USE THESE -->
<fw-button color="primary">Click Me</fw-button>
<fw-input label="Name" placeholder="Enter name"></fw-input>
<fw-select label="Choose"><fw-select-option value="1">Item</fw-select-option></fw-select>
<fw-textarea label="Description"></fw-textarea>
```

### Common Crayons Components:

**Buttons:**
```html
<fw-button color="primary">Primary Button</fw-button>
<fw-button color="secondary">Secondary Button</fw-button>
<fw-button color="danger">Delete</fw-button>
<fw-button color="link">Link Button</fw-button>
```

**Inputs:**
```html
<fw-input label="Email" type="email" placeholder="user@example.com" required></fw-input>
<fw-input label="Password" type="password" state="error" error-text="Invalid password"></fw-input>
```

**Select Dropdowns:**
```html
<fw-select label="Status" placeholder="Select status">
  <fw-select-option value="open">Open</fw-select-option>
  <fw-select-option value="closed">Closed</fw-select-option>
</fw-select>
```

**Labels & Text:**
```html
<fw-label value="User Information"></fw-label>
<fw-inline-message type="success">Data saved successfully!</fw-inline-message>
```

**Spinners & Progress:**
```html
<fw-spinner size="small"></fw-spinner>
<fw-progress-loader value="60" label="Processing..."></fw-progress-loader>
```

### Event Listeners for Crayons:
Crayons components use custom events with `fw` prefix:

```javascript
// Button click
document.getElementById('myBtn').addEventListener('fwClick', () => {
  console.log('Crayons button clicked');
});

// Input change
document.getElementById('myInput').addEventListener('fwInput', (e) => {
  console.log('Input value:', e.detail.value);
});

// Select change
document.getElementById('mySelect').addEventListener('fwChange', (e) => {
  console.log('Selected:', e.detail.value);
});
```

### Crayons Documentation Reference:
All Crayons components are documented in `references/common/crayons-docs/`
- `button.md` - Button component (fw-button)
- `input.md` - Input component (fw-input)
- `select.md` - Select dropdown (fw-select)
- `modal.md` - Modal dialog (fw-modal)
- `spinner.md` - Loading spinner (fw-spinner)
- And 50+ more components...

**If user needs UI, ALWAYS use Crayons. No plain HTML elements allowed!**
