# Installation Parameters: Default vs Custom

## Overview

Every Freshworks Platform 3.0 app requires installation parameters configuration. You have **two options** (choose ONE):

1. **Default iparams** (`config/iparams.json`) - Platform generates Settings form
2. **Custom iparams** (`config/iparams.html`) - You build custom Settings UI

**CRITICAL: You cannot use both in the same app.**

## Default iparams (config/iparams.json)

### When to Use
- ✅ Simple text fields, numbers, dropdowns, checkboxes
- ✅ Basic validation with regex patterns
- ✅ No dynamic behavior needed
- ✅ Standard Settings form is sufficient
- ✅ **Most common approach** - use this by default

### Structure
```json
{
  "api_key": {
    "display_name": "API Key",
    "description": "Enter your API key",
    "type": "text",
    "required": true,
    "secure": true
  },
  "domain": {
    "display_name": "Domain",
    "description": "Your service domain",
    "type": "text",
    "required": true,
    "type_attributes": {
      "regex": {
        "pattern": "^[a-z0-9-]+$",
        "message": "Only lowercase letters, numbers, and hyphens"
      }
    }
  }
}
```

### Files Needed
- `config/iparams.json` (required)
- No other iparam files

### Access in Code
**Frontend:**
```javascript
const iparams = await client.iparams.get(); // All non-secure iparams
const apiKey = await client.iparams.get('api_key'); // Specific iparam
```

**Backend (server.js):**
```javascript
exports = {
  myHandler: function(args) {
    const domain = args.iparams.domain;
    const apiKey = args.iparams.api_key;
  }
};
```

**Request templates:**
```json
{
  "myRequest": {
    "schema": {
      "host": "<%= iparam.domain %>.example.com",
      "headers": {
        "Authorization": "Bearer <%= context.api_key %>"
      }
    }
  }
}
```

## Custom iparams (config/iparams.html)

### When to Use
- ✅ Rich UI needed (nested fields, mappers, sliders, date pickers)
- ✅ Dynamic behavior (pre-fill from API, show/hide sections)
- ✅ Custom validation logic
- ✅ Different UI per product/module
- ✅ "Test connection" or "Pick workspace" buttons
- ✅ Call request templates from Settings page

### Structure
```
config/
├── iparams.html          # Settings page UI
└── assets/
    ├── iparams.js        # Settings page logic
    └── iparams.css       # (optional) Styling
```

### Files Needed
1. **`config/iparams.html`** - Custom Settings UI
   ```html
   <!DOCTYPE html>
   <html>
   <head>
     <script src="{{{appclient}}}"></script>
     <link rel="stylesheet" href="assets/iparams.css">
   </head>
   <body>
     <div class="main">
       <fw-label value="API Key"></fw-label>
       <fw-input id="apiKey" type="password" required></fw-input>
       <fw-button id="testConnection" color="secondary">Test Connection</fw-button>
     </div>
     <script src="assets/iparams.js"></script>
   </body>
   </html>
   ```

2. **`config/assets/iparams.js`** - Settings logic
   ```javascript
   (async function() {
     const client = await app.initialized();
     
     // Load saved values
     client.instance.context().then(context => {
       document.getElementById('apiKey').value = context.api_key || '';
     });
     
     // Test connection button
     document.getElementById('testConnection').addEventListener('fwClick', async () => {
       const apiKey = document.getElementById('apiKey').value;
       // Call request template or validation logic
     });
     
     // Save values - REQUIRED
     function postConfigs() {
       return {
         api_key: document.getElementById('apiKey').value,
         __meta: {
           secure: ['api_key'] // Mark as secure iparam
         }
       };
     }
   })();
   ```

### Key Methods
- **`postConfigs()`** - REQUIRED function that returns iparam object to save
- **`__meta.secure`** - Array of keys to mark as secure (not sent to frontend)
- **`client.instance.context()`** - Get previously saved iparam values

### Access in Code
Same as default iparams:
- Frontend: `client.iparams.get()`
- Backend: `args.iparams.api_key`
- Request templates: `<%= iparam.api_key %>`

## Comparison Table

| Feature | Default (iparams.json) | Custom (iparams.html) |
|---------|------------------------|------------------------|
| **Config file** | `config/iparams.json` | `config/iparams.html` + `config/assets/iparams.js` |
| **UI generated by** | Platform | You (HTML + JS) |
| **Field types** | text, number, dropdown, checkbox, radio, domain, url, multiline | Any HTML/Crayons components |
| **Validation** | Regex patterns | Custom JavaScript |
| **Dynamic behavior** | No | Yes (API calls, show/hide, etc.) |
| **Complexity** | Simple | Advanced |
| **Use when** | Basic Settings form needed | Rich UI or custom logic needed |
| **Access in app** | Same (`iparam.name`) | Same (`iparam.name`) |
| **Can coexist?** | **NO** - Choose one | **NO** - Choose one |

## Migration Path

**From default to custom:**
1. Remove `config/iparams.json`
2. Create `config/iparams.html` with form UI
3. Create `config/assets/iparams.js` with `postConfigs()` returning same structure

**From custom to default:**
1. Remove `config/iparams.html` and `config/assets/iparams.js`
2. Create `config/iparams.json` with equivalent schema

## Best Practices

**Use Default (iparams.json) when:**
- You need simple text fields, dropdowns, checkboxes
- Basic validation with regex is sufficient
- No dynamic behavior required
- **This covers 90% of apps**

**Use Custom (iparams.html) when:**
- You need rich UI (nested fields, mappers, date pickers)
- You need to call APIs from Settings page ("Test connection", "Pick workspace")
- You need conditional fields (show/hide based on other values)
- You need to pre-fill from external API

## Common Mistakes

1. ❌ **Having both `iparams.json` AND `iparams.html`** → FDK validation error
2. ❌ **Forgetting `postConfigs()` in custom iparams** → Settings won't save
3. ❌ **Not marking sensitive fields in `__meta.secure`** → Credentials exposed to frontend
4. ❌ **Using `iparam.json` filename** → Should be `iparams.json` (plural)

## References

- **Default iparams**: `references/runtime/installation-parameters-docs.md`
- **Custom iparams**: `references/runtime/custom-iparams-docs.md`
- **Errors**: `references/errors/installation-parameters-errors.md`
