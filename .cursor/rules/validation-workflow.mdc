---
name: validation-workflow
description: Automatic validation and autofix workflow for Freshworks Platform 3.0 apps
alwaysApply: true
---

# Automatic Validation & Auto-Fix Workflow

**CRITICAL:** After creating ALL app files, you MUST AUTOMATICALLY run validation and attempt fixes.

## Mandatory Workflow

### Step 1: Automatic Validation After File Creation

**AFTER creating all app files, AUTOMATICALLY run `fdk validate`:**

```bash
cd <app-directory>
fdk validate
```

**This MUST happen automatically - DO NOT ask user to run it manually.**

### Step 2: Automatic Error Fixing (2 Iterations)

**CRITICAL: Only fix FATAL errors - Ignore lint errors and warnings**

**What to FIX (Fatal Errors):**
- ‚úÖ JSON parsing errors (multiple top-level objects, syntax errors)
- ‚úÖ Missing required files (`icon.svg`, `manifest.json`)
- ‚úÖ Manifest structure errors (wrong platform version, invalid module structure)
- ‚úÖ Request template errors (FQDN issues, path issues, invalid schema)
- ‚úÖ Missing declarations in manifest (requests, functions, events)
- ‚úÖ OAuth structure errors (missing `integrations` wrapper)
- ‚úÖ Location placement errors (wrong module)

**What to IGNORE:**
- ‚ùå Lint errors (async without await, unused parameters, unreachable code)
- ‚ùå Warnings (non-critical issues)
- ‚ùå Code style issues
- ‚ùå Best practice suggestions

**Iteration 1 - Common Fatal Fixes:**
- Parse validation output and **filter out lint errors/warnings**
- Fix JSON structure errors (multiple top-level objects ‚Üí merge)
- Fix comma placement (missing commas ‚Üí add, trailing commas ‚Üí remove)
- Fix template syntax (`{{variable}}` ‚Üí `<%= context.variable %>`)
- Create missing mandatory files (`icon.svg`, `iparams.json`)
- Create missing mandatory folders (`app/` for frontend apps)
- Fix FQDN issues (host with path ‚Üí FQDN only)
- Fix path issues (missing `/` ‚Üí add `/` prefix)
- Remove `body` from request template schemas (body goes in invocation)
- Add `engines` block if missing (node: "18.20.8", fdk: "9.7.4")
- Remove empty location objects OR add location definition
- Re-run `fdk validate`

**Iteration 2 - Advanced Fatal Fixes (if still failing):**
- Parse remaining fatal errors only (ignore lint/warnings)
- Fix manifest structure issues (wrong module, missing declarations)
- Fix request template declarations (not declared in manifest)
- Fix function declarations (not declared in manifest)
- Fix OAuth structure (missing `integrations` wrapper, wrong `oauth_iparams` location)
- Fix location placement (wrong module for location)
- Re-run `fdk validate`

### Step 3: Present Results

**After 2 Iterations:**

**If validation passes:**
```
‚úÖ App generated and validated successfully!

üìñ **Next Steps:**
1. Install FDK: `npm install -g @freshworks/fdk`
2. Navigate to app directory: `cd <app-directory>`
3. Run: `fdk run`
4. Test your app in the Freshworks product
```

**If validation still fails (fatal errors persist):**
```
‚ö†Ô∏è App generated but validation found FATAL errors that require manual fixes:

[LIST ONLY FATAL ERRORS - IGNORE LINT/WARNINGS]

üîß **Fix Directions:**
[PROVIDE SPECIFIC FIX INSTRUCTIONS FOR EACH FATAL ERROR]

Note: Lint errors and warnings are ignored - only fatal errors are shown.

After fixing, run: `cd <app-directory> && fdk validate`
```

**If validation passes (fatal errors resolved, but lint warnings remain):**
```
‚úÖ App generated and validated successfully!

Note: Some lint warnings may remain, but all fatal errors are resolved.

üìñ **Next Steps:**
1. Install FDK: `npm install -g @freshworks/fdk`
2. Navigate to app directory: `cd <app-directory>`
3. Run: `fdk run`
4. Test your app in the Freshworks product
```

## Critical Rules

- ‚ùå NEVER ask user to run `fdk validate` manually
- ‚úÖ ALWAYS run validation automatically after file creation
- ‚úÖ ALWAYS attempt 2 fix iterations before presenting errors to user
- ‚úÖ ALWAYS re-run `fdk validate` after each fix iteration
- ‚úÖ ONLY present FATAL errors to user if they persist after 2 iterations
- ‚ùå IGNORE lint errors and warnings - only fix fatal errors
- ‚úÖ Consider validation successful if fatal errors are resolved (even if lint warnings remain)

## Reference

See `validation-autofix.mdc` for detailed autofix patterns and examples.
